

# 计算机组成原理



## 为什么学习计算机组成原理

学习应用层的各种语言、框架，好比在练拳法招式，可以短期给予你回报，而深入学习“底层知识”，就是在练扎马步、核心肌肉力量，是在提升你自己的“根骨”和“资质”。

计算机是由 CPU、内存、显示器这些设备组成的硬件。计算机系的学生毕业之后，大部分却都是从事各种软件开发工作。



- 大学计算机系的入门课程。
- 计算机组成原理可以连接硬件和软件。它既隔离了软件和硬件，也提供了让软件无需关心硬件就能直接操作硬件的接口。
- 只需要对硬件有原理性的理解，就可以信赖硬件的可靠性，安安心心用高级语言来写程序。
- 学习组成原理之后，向下，可以学习数字电路相关的课程，向上，可以学习编译原理、操作系统这些核心课程。
- 组成原理是计算机体系结构的一个入门版本。

![img](https://static001.geekbang.org/resource/image/aa/73/aa5f644331319421eb7549d67d4f8773.jpeg)

明白了高级语言是如何对应着 CPU 能够处理的一条条指令，能为你打开编译原理这扇门；搞清楚程序是如何加载运行的，能够让你对操作系统有更深入的理解。



## 如何学习



难学的原因：

- 组成原理中的概念非常多，每个概念的信息量也非常大。比如想要理解 CPU 中的算术逻辑单元（也就是 ALU）是怎么实现加法的，需要牵涉到如何把整数表示成二进制，还需要了解这些表示背后的电路、逻辑门、CPU 时钟、触发器等知识。
- 组成原理中的很多概念，阐述开来就是计算机学科的另外一门核心课程。比如，计算机的指令是怎么从你写的 C、Java 这样的高级语言，变成计算机可以执行的机器码的？如果我们展开并深入讲解这个问题，就会变成《编译原理》这样一门核心课程。
- 学东西是要拿来用的，但因为这门课本身的属性，很多人在学习时，常常沉溺于概念和理论中，无法和自己日常的开发工作联系起来，以此来解决工作中遇到的问题，所以，学习往往没有成就感，就很难有动力坚持下去。



怎么学？

把这些知识点和日常工作、生活以及整个计算机行业的发展史联系起来，真正看懂、学会、记住组成原理的核心内容，更多地从“为什么”这个角度，去理解这些知识点，而不是只是去记忆“是什么”。



- 组成原理里面的知识点结合实际案例代码
- 用生活中的事物类比计算机的组成与运作
- 计算机硬件发展史上的成功和失败
- 把整个的计算机组成原理通过指令、计算、CPU、存储系统和 I/O 串起来
- 通过一个程序的执行过程进行逐层分解，对整个系统有一个全貌的了解



操作系统，其实是在“指令集”上的一层封装。



# 冯·诺依曼体系结构

### 计算机的基本硬件组成

#### CPU

中央处理器（Central Processing Unit）：计算机的所有“计算”都是由 CPU 来进行的。

CPU是一个超级精细的印刷电路板



#### 内存（Memory）

撰写的程序、打开的浏览器、运行的游戏，都要加载到内存里才能运行。程序读取的数据、计算得到的结果，也都要放在内存里。内存越大，能加载的东西自然也就越多。

存放在内存里的程序和数据，需要被 CPU 读取，CPU 计算完之后，还要把数据写回到内存。



#### 主板（Motherboard）

计算机主板上通常有着各种各样的插槽。

主板的芯片组（Chipset）和总线（Bus）解决了 CPU 和内存之间如何通信的问题。芯片组控制了数据传输的流转，也就是数据从哪里到哪里的问题。总线则是实际数据传输的高速公路。因此，总线速度（Bus Speed）决定了数据能传输得多快。



#### 显卡（Graphics Card）

现在，使用图形界面操作系统的计算机，无论是 Windows、Mac OS 还是 Linux，显卡都是必不可少的。

现在的部分cpu集成了gpu，不是主板集成了显卡。如果你用计算机玩游戏，做图形渲染或者跑深度学习应用，你多半就需要买一张单独的显卡，插在主板上。

显卡之所以特殊，是因为显卡里有除了 CPU 之外的另一个“处理器”，也就是 GPU（Graphics Processing Unit，图形处理器），GPU 一样可以做各种“计算”的工作。

现在都是CPU里面直接集成了一个GPU芯片，一般我们叫它”核心显卡“，不过在之前更多是在主板上集成一块显卡，很多时候我们叫它”板载显卡“。太久没有装电脑了，技术已经更新换代了。



#### 硬盘

各种数据持久地保存。

#### I/O 设备

- 显示器

- 鼠标

- 键盘

  

#### 电源



显示器、鼠标、键盘和硬盘这些东西并不是一台计算机必须的部分。





![img](https://static001.geekbang.org/resource/image/63/05/635b154d3f6c7b5d38c65bc80a808d05.jpeg?wh=1536x2048)



图片来自于维基百科，在设计图上，北桥通常靠近CPU，在主板的“北面”。

鼠标、键盘以及硬盘，这些都是插在主板上的。作为外部 I/O 设备，它们是通过主板上的南桥（SouthBridge）芯片组，来控制和 CPU 之间的通信的。“南桥”芯片的名字很直观，一方面，它在主板上的位置，通常在主板的“南面”。另一方面，它的作用就是作为“桥”，来连接鼠标、键盘以及硬盘这些外部设备和 CPU 之间的通信。



以前的主板上通常也有“北桥”芯片，用来作为“桥”，连接 CPU 和内存、显卡之间的通信。不过，随着时间的变迁，现在的主板上的“北桥”芯片的工作，已经被移到了 CPU 的内部，所以你在主板上，已经看不到北桥芯片了。



手机里只有 SD 卡（Secure Digital Memory Card）这样类似硬盘功能的存储卡插槽，并没有内存插槽、CPU 插槽这些东西。没错，因为手机尺寸的原因，手机制造商们选择把 CPU、内存、网络通信，乃至摄像头芯片，都封装到一个芯片，然后再嵌入到手机主板上。这种方式叫 SoC，也就是 System on a Chip（系统芯片）。



这样看起来，个人电脑和智能手机的硬件组成方式不太一样。可是，我们写智能手机上的 App，和写个人电脑的客户端应用似乎没有什么差别，都是通过“高级语言”这样的编程语言撰写、编译之后，一样是把代码和数据加载到内存里来执行。这是为什么呢？因为，无论是个人电脑、服务器、智能手机，还是 Raspberry Pi 这样的微型卡片机，都遵循着同一个“计算机”的抽象概念。这是怎么样一个“计算机”呢？这其实就是，计算机祖师爷之一冯·诺依曼（John von Neumann）提出的冯·诺依曼体系结构（Von Neumann architecture），也叫存储程序计算机。



什么是存储程序计算机呢？这里面其实暗含了两个概念，一个是“可编程”计算机，一个是“存储”计算机。

什么是“不可编程”。计算机是由各种门电路组合而成的，然后通过组装出一个固定的电路板，来完成一个特定的计算程序。一旦需要修改功能，就要重新组装电路。这样的话，计算机就是“不可编程”的，因为程序在计算机硬件层面是“写死”的。最常见的就是老式计算器，电路板设好了加减乘除，做不了任何计算逻辑固定之外的事情。



程序本身是存储在计算机的内存里，可以通过加载不同的程序来解决不同的问题。有“存储程序计算机”，自然也有不能存储程序的计算机。典型的就是早年的“Plugboard”这样的插线板式的计算机。整个计算机就是一个巨大的插线板，通过在板子上不同的插头或者接口的位置插入线路，来实现不同的功能。这样的计算机自然是“可编程”的，但是编写好的程序不能存储下来供下一次加载使用，不得不每次要用到和当前不同的“程序”的时候，重新插板子，重新“编程”。

![img](https://static001.geekbang.org/resource/image/cb/9e/cbf639bab23f61d464aa80b4fd10019e.jpg?wh=1142*777)



无论是“不可编程”还是“不可存储”，都会让使用计算机的效率大大下降。而这个对于效率的追求，也就是“存储程序计算机”的由来。



现代计算机的发展就从冯·诺依曼写的一份草案开始了。First Draft 里面说了一台计算机应该有哪些部分组成：

- 一个包含算术逻辑单元（Arithmetic Logic Unit，ALU）和处理器寄存器（Processor Register）的处理器单元（Processing Unit），用来完成各种算术和逻辑运算。        因为它能够完成各种数据的处理或者计算工作，因此也有人把这个叫作数据通路（Datapath）或者运算器。
- 一个包含指令寄存器（Instruction Register）和程序计数器（Program Counter）的控制器单元（Control Unit/CU），用来控制程序的流程，通常就是不同条件下的分支和跳转。

在现在的计算机里，上面的算术逻辑单元和这里的控制器单元，共同组成了我们说的 CPU。

- 用来存储数据（Data）和指令（Instruction）的内存
- 更大容量的外部存储，在过去，可能是磁带、磁鼓这样的设备，现在通常就是硬盘。
- 各种输入和输出设备，以及对应的输入和输出机制。

**任何一台计算机的任何一个部件都可以归到运算器、控制器、存储器、输入设备和输出设备中，而所有的现代计算机也都是基于这个基础架构来设计开发的。**

而所有的计算机程序，也都可以抽象为从**输入设备**读取输入信息，通过**运算器和控制器**来执行存储在**存储器**里的程序，最终把结果输出到**输出设备**中。而我们所有撰写的无论高级还是低级语言的程序，也都是基于这样一个抽象框架来进行运作的。

![img](https://static001.geekbang.org/resource/image/fa/2b/fa8e0e3c96a70cc07b4f0490bfe66f2b.jpeg?wh=2372*1505)

冯·诺依曼体系结构确立了我们现在每天使用的计算机硬件的基础架构。因此，学习计算机组成原理，其实就是学习和拆解冯·诺依曼体系结构。

具体来说，学习组成原理，其实就是学习控制器、运算器的工作原理，也就是 CPU 是怎么工作的，以及为何这样设计；学习内存的工作原理，从最基本的电路，到上层抽象给到 CPU 乃至应用程序的接口是怎样的；学习 CPU 是怎么和输入设备、输出设备打交道的。

学习组成原理，就是在理解从控制器、运算器、存储器、输入设备以及输出设备，从电路这样的硬件，到最终开放给软件的接口，是怎么运作的，为什么要设计成这样，以及在软件开发层面怎么尽可能用好它。



我一直认为，读读经典的论文，是从一个普通工程师迈向优秀工程师必经的一步。如果你有时间，不妨去读一读[First Draft of a Report on the EDVAC](https://en.wikipedia.org/wiki/First_Draft_of_a_Report_on_the_EDVAC)。对于工程师来说，直接读取英文论文的原文，既可以搞清楚、弄明白对应的设计及其背后的思路来源，还可以帮你破除对于论文或者核心技术的恐惧心理。



**图灵机和冯·诺依曼机是两种不同的计算机么？图灵机是一种什么样的计算机抽象呢？**

冯·诺依曼机侧重于硬件抽象，而图灵机侧重于计算抽象。



- 图灵机是一种思想模型（计算机的基本理论基础），是一种有穷的、构造性的问题的问题求解思路，图灵认为凡是能用算法解决的问题也一定能用图灵机解决；
- 冯诺依曼提出了“存储程序”的计算机设计思想，并“参照”图灵模型设计了历史上第一台电子计算机，即冯诺依曼机。



图灵机和冯诺依曼机并不是两种计算机，他们只是描述的侧重点不同而已！

冯诺依曼机侧重于"程序存储"与"二进制执行"，并提出实现这两点必须的五个部分:控制器，处理器，存储单元，输入和输出设备。这个体系基本奠定了近现代计算机的硬件基础，所以冯诺依曼被称为"计算机之父"！

图灵机则是一个理想状态，它侧重于计算与逻辑。图灵提出的是一种关于计算机科学计算与逻辑的构想，解决的就是哪些“可计算”，哪些“不可计算”的问题。所以，图灵被称为"计算机科学之父"！

所以，一个侧重的是组成结构，一个侧重的是逻辑运算，他们两者共同构成了现在的计算机！

图零机是一个抽象的”思维实验“，而冯诺依曼机就是对应着这个”思维实验“的”物理实现“。相互之间颇有理论物理学家和实验物理学家的合作关系的意思，可谓是一个问题的一体两面。





## 学习姿势

![img](https://static001.geekbang.org/resource/image/12/ff/12bc980053ea355a201e2b529048e2ff.jpg?wh=3832*2540)



**整个计算机组成原理，就是围绕着计算机是如何组织运作展开的。**



- 计算机的基本组成
- 计算机的指令和计算
- 处理器设计
- 存储器和 I/O 设备

### 计算机的基本组成

学习计算机是由哪些硬件组成的。这些硬件，又是怎么对应到经典的冯·诺依曼体系结构中的，也就是运算器、控制器、存储器、输入设备和输出设备这五大基本组件。除此之外，你还需要了解计算机的两个核心指标，性能和功耗。





### 计算机的指令和计算

搞明白撰写的一行行 C、Java、PHP 程序，是怎么在计算机里面跑起来的。

了解我们的程序是怎么通过编译器和汇编器，变成一条条机器指令的编译过程（编译原理课程）。操作系统是怎么链接、装载、执行这些程序的（操作系统课程课程）。

而这一条条指令执行的控制过程，就是由计算机五大组件之一的**控制器**来控制的。

在计算机的计算部分，从二进制和编码开始，理解数据在计算机里的表示，以及是怎么从数字电路层面，实现加法、乘法这些基本的运算功能的。实现这些运算功能的 ALU（Arithmetic Logic Unit/ALU），也就是算术逻辑单元，其实就是计算机五大组件之一的**运算器**。





